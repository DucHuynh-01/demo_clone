(function(){"use strict";var h=(e=>(e.Local="local",e.Sync="sync",e.Managed="managed",e.Session="session",e))(h||{}),P=(e=>(e.ExtensionPagesOnly="TRUSTED_CONTEXTS",e.ExtensionPagesAndContentScripts="TRUSTED_AND_UNTRUSTED_CONTEXTS",e))(P||{}),_=(e,n,t)=>new Promise((c,s)=>{var v=o=>{try{a(t.next(o))}catch(l){s(l)}},f=o=>{try{a(t.throw(o))}catch(l){s(l)}},a=o=>o.done?c(o.value):Promise.resolve(o.value).then(v,f);a((t=t.apply(e,n)).next())});const i=globalThis.chrome;function w(e,n){return _(this,null,function*(){function t(s){return typeof s=="function"}function c(s){return s instanceof Promise}return t(e)?(c(e),e(n)):e})}let S=!1;function O(e){if(i&&i.storage[e]===void 0)throw new Error(`Check your storage permission in manifest.json: ${e} is not defined`)}function z(e,n,t){var c,s,v,f,a,o;let l=null,b=!1,p=[];const u=(c=t==null?void 0:t.storageEnum)!=null?c:h.Local,V=(s=t==null?void 0:t.liveUpdate)!=null?s:!1,X=(f=(v=t==null?void 0:t.serialization)==null?void 0:v.serialize)!=null?f:r=>r,L=(o=(a=t==null?void 0:t.serialization)==null?void 0:a.deserialize)!=null?o:r=>r;S===!1&&u===h.Session&&(t==null?void 0:t.sessionAccessForContentScripts)===!0&&(O(u),i==null||i.storage[u].setAccessLevel({accessLevel:P.ExtensionPagesAndContentScripts}).catch(r=>{console.warn(r),console.warn("Please call setAccessLevel into different context, like a background script.")}),S=!0);const m=()=>_(this,null,function*(){var r;O(u);const d=yield i==null?void 0:i.storage[u].get([e]);return d&&(r=L(d[e]))!=null?r:n}),y=()=>{p.forEach(r=>r())},$=r=>_(this,null,function*(){b===!1&&(l=yield m()),l=yield w(r,l),yield i==null?void 0:i.storage[u].set({[e]:X(l)}),y()}),M=r=>(p=[...p,r],()=>{p=p.filter(d=>d!==r)}),q=()=>l;m().then(r=>{l=r,b=!0,y()});function B(r){return _(this,null,function*(){if(r[e]===void 0)return;const d=L(r[e].newValue);l!==d&&(l=yield w(d,l),y())})}return V&&(i==null||i.storage[u].onChanged.addListener(B)),{get:m,set:$,getSnapshot:q,subscribe:M}}var A=Object.defineProperty,D=Object.defineProperties,j=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,C=(e,n,t)=>n in e?A(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,F=(e,n)=>{for(var t in n||(n={}))x.call(n,t)&&C(e,t,n[t]);if(T)for(var t of T(n))N.call(n,t)&&C(e,t,n[t]);return e},U=(e,n)=>D(e,j(n)),R=(e,n,t)=>new Promise((c,s)=>{var v=o=>{try{a(t.next(o))}catch(l){s(l)}},f=o=>{try{a(t.throw(o))}catch(l){s(l)}},a=o=>o.done?c(o.value):Promise.resolve(o.value).then(v,f);a((t=t.apply(e,n)).next())});const E=z("theme-storage-key","light",{storageEnum:h.Local,liveUpdate:!0}),g=U(F({},E),{toggle:()=>R(void 0,null,function*(){yield E.set(e=>e==="light"?"dark":"light")})});async function I(){console.log("initial theme:",await g.get()),await g.toggle(),console.log("toggled theme:",await g.get())}console.log("content script loaded"),I()})();
